<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Напиточки</title>

    <style>
        button {
            cursor: pointer;
        }

        .wrapModal {
            width: 100vw;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 2;
            background-color: black;
            opacity: 0.7;
            display: none;
        }

        .modal {
            min-width: 300px;
            min-height: 300px;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background-color: #fff;

            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 15px;
            padding: 10px;
            padding-bottom: 50px;
        }

        .modal-close {
            position: absolute;
            top: -15px;
            right: 0;
            color: #000;
            font-size: 50px;
            cursor: pointer;
        }

        #saveDrink {
            align-self: center;
            width: 100%;
            background-color: #000;
            color: #fff;
            border: none;
            font-size: 25px;
            cursor: pointer;
            position: absolute;
            bottom: 10px;
        }

        #blockDrinkName,
        #blockAlcogol,
        #blockIngredients,
        #saveDrink {
            display: none;
        }
    </style>
</head>

<body>
    <button id="addDrink">
        ввод информации о напитке
    </button>

    <button id="infoDrink">
        получение информации о напитке
    </button>

    <button id="delDrink">
        удаление информации о напитке
    </button>

    <button id="listDrinks">
        перечень всех напитков
    </button>


    <div class="wrapModal">
        <div class="modal">
            <span class="modal-close">×</span>
            <form id="formDrink">
                <div id="blockDrinkName">
                    <label for="drinkName">Название напитка</label> <br>
                    <input type="text" id="drinkName" required>
                </div>

                <div id="blockAlcogol">
                    <label for="alcogol">Он алкогольный?</label> <br>
                    <label for="alcogol">Да</label><input type="radio" name="alcogol" checked>
                    <label for="alcogol">Нет</label><input type="radio" name="alcogol">
                </div>

                <div id="blockIngredients">
                    <div>
                        <label for="ingredient">Ингридиент № <span id="ingredientNumber">1</span></label> <br>
                        <input type="text" id="ingredient" required>
                        <button id="addIngredient">добавить ещё ингридиент</button>
                    </div>
                </div>

                <button id="saveDrink">сохранить напиток</button>
            </form>
        </div>
    </div>

    <script>
        class HashStorageClass {
            constructor() {
                this.storage = {}
            }

            addValue = function (key, value) {
                this.storage[key] = value
            }
            getValue = function (key) {
                return this.storage[key]
            }
            deleteValue = function (key) {
                if (key in this.storage) {
                    delete this.storage[key]
                    return true
                }
                return false
            }
            getKeys = function () {
                return Object.keys(this.storage)
            }
        }

        const drinkStorage = new HashStorageClass

        const wrapModal = document.querySelector('.wrapModal')
        const modal = document.querySelector('.modal')
        const closeModal = document.querySelector('.modal-close')
        const formDrink = document.getElementById('formDrink')
        const addDrinkBtn = document.getElementById('addDrink')
        const addIngredientBtn = document.getElementById('addIngredient')
        const saveDrinkBtn = document.getElementById('saveDrink')

        const blockDrinkName = document.getElementById('blockDrinkName')
        const blockAlcogol = document.getElementById('blockAlcogol')
        const blockIngredients = document.getElementById('blockIngredients')

        function closeModalWindow() {
            wrapModal.style.display = 'none'
            blockDrinkName.style.display = 'none'
            blockAlcogol.style.display = 'none'
            blockIngredients.style.display = 'none'
            saveDrinkBtn.style.display = 'none'
            formDrink.reset()
        }

        let i = 2
        addIngredientBtn.addEventListener('click', () => {
            const ingredient = document.createElement('div')

            ingredient.innerHTML = `
                <label for="ingredient">Ингридиент № <span id="ingredientNumber">${i}</span></label> <br>
                <input type="text" id="ingredient">
            `
            blockIngredients.appendChild(ingredient)
            i++
        })

        closeModal.addEventListener('click', closeModalWindow)
        wrapModal.addEventListener('click', closeModalWindow)
        modal.addEventListener('click', (event) => {
            event.stopPropagation()
        })

        addDrinkBtn.addEventListener('click', () => {
            wrapModal.style.display = 'block'
            blockDrinkName.style.display = 'block'
            blockAlcogol.style.display = 'block'
            blockIngredients.style.display = 'block'
            saveDrinkBtn.style.display = 'block'

            saveDrinkBtn.addEventListener('click', () => {
                const drinkName = document.getElementById('drinkName').value
                const alcogol = document.querySelector('input[name="alcogol"]:checked').value
                const ingredients = Array.from(document.querySelectorAll('#blockIngredients div'))
                const recipe = ingredients.map(ingredient => ingredient.querySelector('input').value)
                if (!drinkName || !alcogol || !recipe[0]) return
                drinkStorage.addValue(drinkName, { 'алкогольный': alcogol, 'рецепт': recipe })
                closeModalWindow()
                alert('напиток сохранён')
            })

        })

        const infoDrinkBtn = document.getElementById('infoDrink')
        infoDrinkBtn.addEventListener('click', () => {
            const requestedDrink = emptyStr()
            const drinkInfo = drinkStorage.getValue(requestedDrink)
            if (drinkInfo) {
                alert(`
                напиток: ${requestedDrink}
                алькогольный: ${drinkInfo.алкогольный ? 'да' : 'нет'}
                рецепт приготовления: 
                ${drinkInfo.рецепт.join(', ')}
                `)
            }
            else alert('нет такого напитка! добавьте')
        })

        const delDrinkBtn = document.getElementById('delDrink')
        delDrinkBtn.addEventListener('click', () => {
            const delDrink = emptyStr()
            if (delDrink) {
                const deleted = drinkStorage.deleteValue(delDrink)
                deleted ? alert('напиток удалён') : alert('нет такого напитка, не удалю!')
            }
        })

        const listBtn = document.getElementById('listDrinks')
        listBtn.addEventListener('click', () => {
            if (drinkStorage.getKeys()[0]) {
                // alert(`все напитки: ${drinkStorage.getKeys().join(', ')}`)
                wrapModal.style.display = 'block'
                const list = document.createElement('div')
                list.innerHTML = `
                <p>все напитки:</p>
                    <ul>
                        ${drinkStorage.getKeys().map(drink => `<li>${drink}</li>`).join('')}
                    </ul>
                `
                formDrink.appendChild(list)
            }
            else alert('нету напитков в базе')

        })
    </script>
</body>

</html>